"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="11e0def9-00c4-52d6-9895-18f19ac2a7b0")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[3970],{568716:(e,t,o)=>{o.d(t,{Do:()=>m,Du:()=>p,El:()=>C,JO:()=>I,Jx:()=>h,Lp:()=>v,Mc:()=>g,ON:()=>i,RW:()=>f,Rq:()=>d,Vr:()=>u,Vs:()=>E,Y:()=>l,YZ:()=>s,ZF:()=>w,h3:()=>y,hu:()=>_,jG:()=>c,kL:()=>a,qc:()=>r,qp:()=>b,se:()=>n,xn:()=>k});let a="post_to_feed_view--container--BiDZs",n="post_to_feed_view--noContentContainer--VE8Tm post_to_feed_view--container--BiDZs text--fontPos16--oMC-G text--_fontBase--QdLsd",l="post_to_feed_view--searchFilterContainer--lyX72",i="post_to_feed_view--searchBar--IwmvI",r="post_to_feed_view--searchIcon---WXsZ",d="post_to_feed_view--caretIcon--akCZQ",s="post_to_feed_view--pageMenuDropdown--bS4RV",c="post_to_feed_view--scrollContainer--syalR",_="post_to_feed_view--innerScrollContainer--aP8K2",m="post_to_feed_view--loadingSpinnerContainer--E8n20",f="post_to_feed_view--pageSection--85j7J",u="post_to_feed_view--pageHeader--ZOfTF",p="post_to_feed_view--pageHeaderFaint--p-zwO",g="post_to_feed_view--tilesGrid--Ft03l",E="post_to_feed_view--tile--9a4ta",C="post_to_feed_view--selectedTile--D6T9A post_to_feed_view--tile--9a4ta",y="post_to_feed_view--tileThumbnail--FkrR9",h="post_to_feed_view--tileOverlay--iyl2x",I="post_to_feed_view--tileDetails--FZrxQ",b="post_to_feed_view--nodeName--jbJro",k="post_to_feed_view--thumbnail--uAumv",v="post_to_feed_view--notFoundContainer--5cMl3 text--fontPos16--oMC-G text--_fontBase--QdLsd",w="post_to_feed_view--searchQuery--TIyhI"},674222:(e,t,o)=>{o.d(t,{CQ:()=>i,DA:()=>h,Fd:()=>_,KG:()=>I,RO:()=>p,UD:()=>d,YI:()=>m,_5:()=>k,_f:()=>r,aF:()=>s,ku:()=>E,lt:()=>C,pb:()=>f,q3:()=>y,w8:()=>n,wg:()=>b,xe:()=>l,y3:()=>a,yD:()=>c,zE:()=>g,zb:()=>u});let a="create_feed_post_modal--avatarFloat--iIveN",n="create_feed_post_modal--addBorder--ioWGk",l="create_feed_post_modal--contentContainerV2--QwkuY",i="create_feed_post_modal--buttonRowV3--5nAjk modal--buttonRow--o2A0S",r="create_feed_post_modal--buttonRowLeft--TRB9A",d="create_feed_post_modal--buttonContainer--eO4q8",s="create_feed_post_modal--inputSectionMinimized--bq7wz create_feed_post_modal--inputSection--7p1jN",c="create_feed_post_modal--inputFields--bFFV7",_="create_feed_post_modal--draftText--n3VG5",m="create_feed_post_modal--postLoadingSpinner--rky-A",f="create_feed_post_modal--postButton--kaBoj",u="create_feed_post_modal--postingButton--VH5JE create_feed_post_modal--postButton--kaBoj",p="create_feed_post_modal--modalWrapper--4Bi1n",g="create_feed_post_modal--modalWrapperMinimized--syjBM create_feed_post_modal--modalWrapper--4Bi1n",E="create_feed_post_modal--contentNonEmpty--vTrJ6",C="create_feed_post_modal--contentWrapperMinimizedV2--Y56bB create_feed_post_modal--contentWrapperV2--CuYTA",y="create_feed_post_modal--contentWrapperV3--bCplT create_feed_post_modal--contentWrapperV2--CuYTA",h="create_feed_post_modal--descriptionWrapperV3--KrwNd",I="create_feed_post_modal--avatarAndDescriptionWrapperMinimized--yrvzI create_feed_post_modal--avatarAndDescriptionWrapper--JTvU3",b="create_feed_post_modal--minimizedButtonContainerV2--ZJZV- create_feed_post_modal--minimizedButtonContainer--fxgaf",k="create_feed_post_modal--loadingWrapper--mesOB"},461839:(e,t,o)=>{o.r(t),o.d(t,{CreateFeedPostContent:()=>j,CreateFeedPostModal:()=>G,getUploadErrorMessage:()=>q});var a=o(411855),n=o(188507),l=o(140593),i=o(629019),r=o.n(i),d=o(776250),s=o(609494),c=o(358145),_=o(966712),m=o(418956),f=o(498750),u=o(860601),p=o(395900),g=o(743282),E=o(27087),C=o(448169),y=o(946689),h=o(493323),I=o(881388),b=o(939863),k=o(392592),v=o(67294),w=o(507877),F=o(662275),S=o(694687),x=o(860178),N=o(204279),T=o(531827),M=o(28588),D=o(103271),P=o(261076),A=o(126674),B=o(679736),K=o(406158),L=o(757022),O=o(583630),R=o(660040),z=o(160156),W=o(339617),V=o(462256),Z=o(782680),U=o(722388),Q=o(674222);let X=[B.My.CONTEXT_MENU,B.My.SHARE];function q(e){switch(e.type){case M.Wn.MAX_UPLOADS_EXCEEDED:return(0,b.t)("fig_feed.too_many_content_items",e.params);case M.Wn.MAX_VIDEO_SIZE_EXCEEDED:return(0,b.t)("fig_feed.video_file_size_limit_MB",e.params);case M.Wn.MAX_IMAGE_SIZE_EXCEEDED:return(0,b.t)("fig_feed.image_file_size_limit_MB",e.params);case M.Wn.INVALID_FILE_TYPE:return(0,b.t)("fig_feed.unsupported_file_types_were_not_uploaded");case M.Wn.DUPLICATE_FILE_UPLOAD:return(0,b.t)("fig_feed.already_uploaded_items",e.params);case M.Wn.FAILED_TO_UPLOAD:return(0,b.t)("fig_feed.error_on_feed_post_creation");default:(0,l.xb)(e)}}function G(e){let t=(0,n.wA)(),o=(0,S.sZ)(),l=(0,P.R)(),i=a.useCallback(()=>{t(F.Ce())},[t]),r=(o?.name&&(0,b.tx)("fig_feed.post_to_org_feed",{orgName:o.name}))??(0,b.tx)("fig_feed.post_to_feed");return a.createElement(V.j,{title:r,onClose:()=>l(i)},a.createElement(j,{nodeInfo:e.nodeInfo,uploadInfo:e.uploadInfo,prototypeInfo:e.prototypeInfo,pageBackgroundColor:e.pageBackgroundColor,onSubmitSuccess:e.onSubmitSuccess,entryPoint:e.entryPoint,lockedFileKey:e.lockedFileKey}))}function j(e){let t=(0,n.wA)(),o=(0,S.sZ)(),l=(0,x.iZ)(),[i,G]=(0,m.fp)(P.T),[j,J]=a.useState(!1),[Y,$]=a.useState(!0),[H,ee]=a.useState(!1),[et,eo]=a.useState(!1),[ea,en]=a.useState((0,b.t)("fig_feed.title_input_placeholder")),[el,ei]=a.useState(e.nodeInfo??null),er=e.setMinimized,ed=a.useCallback(e=>{er&&er(e)},[er]),es=(0,n.d4)(e=>e.modalShown),[ec,e_]=a.useState((0,g.g)()),[em,ef]=a.useState(0),eu=a.useCallback(()=>{eM(""),eP([]),ed(!0),ee(!1),eI([]),e_((0,g.g)()),ef(0),ei(null)},[ed]),ep=a.useCallback(()=>{t((0,F.to)({type:Z.h,data:{onConfirm:eu},showModalsBeneath:!0}))},[t,eu]),eg=()=>{en(D.ZP[Math.floor(Math.random()*D.ZP.length)]())};a.useEffect(()=>{eg()},[]);let eE=e.pageBackgroundColor,eC=el?.fileKey??e.prototypeInfo?.fileKey??"";a.useEffect(()=>{let t={entryPoint:e.entryPoint};eC&&(t.fileKey=eC),(0,d.sx)("Team Feed Create Post Modal Opened",t)},[e.entryPoint,eC]);let ey=a.useCallback((e,a)=>{if(a){t(F.Ce());return}let n={text:(0,b.t)("fig_feed.view_post"),action:()=>{t(w.V3({url:(0,A.Kc)(o.id,{uuid:e})}))}};t(k.F.enqueue({message:(0,b.t)("fig_feed.posted_to_org_feed",{orgName:o.name}),button:n})),t(F.Ce())},[t,o]),[eh,eI]=a.useState([]),eb=a.useMemo(()=>new Set(eh.map(e=>e.displayContentItem.type===D.cM.NODE?e.displayContentItem.nodeId:null).filter(e=>null!==e)),[eh]);a.useEffect(()=>{(0,L.sr)(el,eb,eI,o?.id,eE)},[el,eb,eI,o?.id,eE]);let ek=a.useRef(null);a.useEffect(()=>{let t=e.prototypeInfo;if(!o?.id||!t||ek.current)return;let a=(0,K.WI)(t,o.id);ek.current=a.displayContentItem,eI(e=>[...e.filter(e=>e.displayContentItem.type!==D.cM.PROTOTYPE),a])},[o?.id,e.prototypeInfo]);let ev=a.useCallback(e=>{let t=(0,z.K1)(eh[em].displayContentItem);ef(e.findIndex(e=>(0,z.K1)(e)===t));let o=[];e.forEach(e=>{let t=(0,z.K1)(e),a=eh.find(e=>(0,z.K1)(e.displayContentItem)===t);a?o.push(a):console.error("Expected to have a matchedPendingItem")}),eI(o)},[eh,em]),ew=a.useCallback(e=>{ef(eh.findIndex(t=>(0,z.K1)(t.displayContentItem)===e))},[eh]),{setContentPreview:eF,snapshotStates:eS}=(0,L.eh)(eh,eI),{onSubmitSuccess:ex}=e,eN=a.useCallback((o,a)=>{E.Ay.post("/api/feed_posts",o).then(o=>{X.includes(e.entryPoint)?ey(o.data.meta.public_uuid,a):(eu(),eg()),a&&t(k.F.enqueue({message:(0,b.t)("fig_feed.post_submission_pending")})),ex&&ex(a)}).catch(()=>{t(I.s.error((0,b.t)("fig_feed.error_on_feed_post_creation"))),$(!1)})},[t,ey,ex,eu,e.entryPoint]),[eT,eM]=a.useState(""),[eD,eP]=a.useState([]),eA=a.useMemo(()=>({library:new T.M8(o.id)}),[o]);a.useEffect(()=>{$(eT.trim().length>R.Y||(0,s._Z)(eD).length>R.e||0===eh.length)},[eT,eD,eh.length]),a.useEffect(()=>{let e=eT.trim().length>0||!(0,s.I)(eD);J(e||eh.length>0),G(e)},[eD,G,eT,eh.length]);let eB=e.lockedFileKey||el?.fileKey,eK=async a=>{let n=new p.M4;if(n.start(),(0,d.sx)("team_feed_onsubmit",{currentOrgPresent:!!o,submitDisabled:Y},{logFromProber:!0}),!o||Y)return;a?.preventDefault(),$(!0);let l={description_meta:eD,org_id:o.id};l.background_color=eE;let i=(0,s._Z)(eD);l.content=await (0,K.pj)(t,eh,eC,eT),(0,d.sx)("team_feed_content_awaited",{payloadContent:JSON.stringify(l.content)},{logFromProber:!0});let r=l.content.some(e=>e.pending);l.uuid=ec,eT?l.title=eT:l.title=i.length>0?i.slice(0,40)+"\u2026":(0,b.t)("fig_feed.untitled_post"),eB&&(l.attached_file_key=eB),eN(l,r),n.stop(),(0,d.sx)("team_feed_click_to_post_latency",{elapsedTimeMs:n.getElapsedTime()},{forwardToDatadog:!0}),(0,d.sx)("Team Feed New Post Submitted",{fileKey:eC,entryPoint:e.entryPoint,text:i,numContentItems:l.content.length,contentItemTypes:l.content.map(e=>e.type)},{forwardToDatadog:!0})},eL=a.useCallback((e,a)=>{if(!o)return;let n=Array.from(e);if(0===n.length)return;let l=(0,N.KT)(n,eh.length,D.e3,D.bB,e=>{t(k.F.enqueue({message:q(e)}))},eh.map(e=>e.fileIdentifier)).map(e=>{let t=(0,N.Fn)(e);if(M.xp.includes(e.type))return(0,K.zr)(t,e);if(M.VY.includes(e.type))return(0,K.X2)(t,ec,o.id,e);throw Error("unexpected file type")}),i=void 0!==a?a:eh.length;eI(e=>[...e.slice(0,i),...l,...e.slice(i)]),ef(i)},[t,o,ec,eh]),eO=a.useCallback((e,t)=>()=>{let o=e.current?.files||null;null!==o&&0!==o.length&&(eL(o,t),ed(!1),e.current&&(e.current.value=""))},[eL,ed]),eR=(0,c.ZC)(e.uploadInfo);a.useEffect(()=>{e.uploadInfo&&e.uploadInfo!==eR&&(ed(!1),eL(e.uploadInfo))},[e.uploadInfo,eR,ed,eL]);let ez=a.useCallback(e=>{let t=Math.min(e,Math.max(0,eh.length-2)),o=eh[e];if((0,K.AK)(o),eI(t=>t.filter((t,o)=>o!==e)),o.displayContentItem.type===D.cM.NODE){let e=o.displayContentItem.nodeId;ei(t=>{if(t){let o=t.nodeIds.filter(t=>t!==e),a=t.nodeThumbnails,n=a&&o.reduce((e,t)=>(e[t]=a[t],e),{});return{...t,nodeIds:o,nodeThumbnails:n}}return null})}ef(t)},[eh]),eW=a.useCallback((e,t)=>{eL(e.files,t),eo(!1)},[eL]),eV=a.useRef(null),eZ=!!el?.nodeIds?.length,{openPostFromFileModal:eU,attachedFileData:eQ}=(0,L.Ld)({setLinkedFileNodeInfo:ei,numUserContentItems:eh.length,hasNodeContent:eZ,parentModalRef:eV,attachedFileKey:eB,lockedFileKey:e.lockedFileKey,currentOrgId:o?.id}),eX=a.useCallback(()=>{let e=eh.map(e=>e.displayContentItem);return a.createElement(C.Y,{className:r()(Q.xe,et&&Q.w8),isDragTarget:()=>!0,onTargetDragEnter:()=>eo(!0),onTargetDragLeave:()=>eo(!1),onTargetDrop:e=>eW(e)},a.createElement(z.Zo,{contentItems:e,staticContent:!0,scrollable:!1,deleteItemAtIdx:H?void 0:ez,pageBackgroundColor:eE,onReorderCallback:H?void 0:ev,shouldScrollToIndex:null,selectedIdx:em,setSelectedIdx:ef,onFileInputChange:eO,setSelectedContent:ew,snapshotStates:eS,setContentPreview:eF,openPostFromFileModal:eU,attachedFile:eQ,dragging:et,mode:"create"}))},[eE,et,ev,ez,H,eh,eW,em,eO,ew,eS,eF,eU,eQ]),eq=a.useCallback(e=>{e.keyCode===f.Uz.ESCAPE&&ed(!0)},[ed]),eG=a.useCallback(()=>{es||(j&&(eM(e=>e.trim()),(0,s.I)(eD)&&eP([])),ed(!0))},[eD,ed,es,j]),ej=a.useCallback(()=>{eG(),t(F.Ce())},[t,eG]),eJ=a.createElement("div",{className:r()(Q.zE,i&&Q.ku),onKeyDown:e.disabled?u.lQ:eq,role:"textbox",tabIndex:0,onClick:()=>!e.disabled&&ed(!1)},l&&a.createElement("div",{className:Q.y3},a.createElement(W.A,{user:l,size:v.Pf.LARGE})),a.createElement("div",{className:Q.lt},a.createElement("div",{className:Q.KG},a.createElement("div",{className:Q.aF},a.createElement("div",{className:Q.yD},eT||ea," ",eT&&a.createElement("span",{className:Q.Fd},(0,b.t)("fig_feed.draft")))),a.createElement("div",{className:Q.wg},a.createElement(y.$$,{disabled:!0,dataTestId:"feed-post-post"},(0,b.tx)("fig_feed.post")))))),eY=a.createElement("div",{className:Q.RO,onKeyDown:eq,role:"textbox",tabIndex:0,onClick:()=>ed(!1),ref:eV},a.createElement("div",{className:Q.q3},eX(),o&&l?a.createElement("div",{className:Q.DA},a.createElement(O.FeedPostUnifiedComposer,{user:l,currentOrgId:o.id,autofocus:!0,mentionables:eA,onSubmit:Y?void 0:eK,submitOnEnter:!1,hideSubmitButton:!0,description:eD,updateDescription:eP,title:eT,updateTitle:eM,displayDecoratorsDownwards:!0,minimized:e.minimized,readOnly:H,editableTypeaheadClass:U.up,openPostFromFileModal:()=>eU({skipFrameSelection:!eZ}),fileData:eQ,lockFileAddition:eh.length>=D.e3,parentRef:eV,canUnlinkFile:!eZ&&!e.lockedFileKey,unlinkFile:()=>ei(null)})):null),a.createElement("div",{className:Q.CQ},a.createElement("div",{className:Q.UD},!X.includes(e.entryPoint)&&(j?a.createElement(y.nR,{onClick:e=>{e.stopPropagation(),ep()}},(0,b.tx)("fig_feed.discard_draft")):a.createElement(y.nR,{onClick:e=>{e.stopPropagation(),eu()}},(0,b.tx)("general.cancel"))),a.createElement(y.$$,{onClick:e=>{if(!H)return ee(!0),eK(e).finally(()=>{ee(!1)})},disabled:Y,dataTestId:"feed-post-post",className:H?Q.zb:Q.pb},H&&a.createElement("div",{className:Q.YI},a.createElement(h.kt,{shouldMatchTextColor:!0,size:"medium"})),H?(0,b.tx)("fig_feed.posting"):(0,b.tx)("fig_feed.post"))))),e$=(o?.name&&(0,b.tx)("fig_feed.post_to_org_feed",{orgName:o.name}))??(0,b.tx)("fig_feed.post_to_feed");return o&&l&&(0,_.kc)().xr_debounce_threshold?e.entryPoint===B.My.FEED_HEADER?a.createElement(a.Fragment,null,eJ,!e.minimized&&a.createElement(V.j,{title:e$,onClose:ej},eY)):eY:null}},462256:(e,t,o)=>{o.d(t,{j:()=>r});var a=o(411855),n=o(271779),l=o(585878),i=o(67577);function r(e){return a.createElement(n.i,{displayAs:n.C.Block},a.createElement(l.XV,{title:a.createElement("div",{className:"feed_modal_base--title--HN9jR"},e.title),maxWidth:i.b,minWidth:i.X,fixedTop:!1,onClose:e.onClose,headerClassName:"feed_modal_base--header--gAhz4",closeOnEsc:!0},e.children))}},757022:(e,t,o)=>{o.d(t,{sr:()=>V,eh:()=>U,Ld:()=>Z});var a=o(411855),n=o(109388),l=o(188507),i=o(539321),r=o(939863),d=o(392592),s=o(662275),c=o(421123),_=o(540019),m=o(103271),f=o(406158),u=o(160156),p=o(140593),g=o(629019),E=o.n(g),C=o(540193),y=o(823810),h=o(391388),I=o(860601),b=o(768137),k=o(493323),v=o(355819),w=o(860178),F=o(498606),S=o(237870),x=o(761939),N=o(706638),T=o(227795),M=o(585878),D=o(775481);let P="post_from_file_modal--grid--JdmAi",A="post_from_file_modal--searchLoadingSpinnerContainer---qSgU post_from_file_modal--loadingSpinnerContainer--QaXkG";var B=o(647173);let K=`https://${window.location.host}`;var L=(e=>(e[e.SELECT_FILE=1]="SELECT_FILE",e[e.SELECT_NODE=2]="SELECT_NODE",e))(L||{});function O(e){let t=a.useRef(null),o=(0,w.TA)(),n=encodeURIComponent(`${e.selectedFile.url}?fuid=${o}&post-to-feed=1&force-incremental=0`),l=`${K}/embed?integration_host=fig-feed&url=${n}`,[i,d]=a.useState(!1),[s,c]=a.useState([]);a.useEffect(()=>{let e=e=>{if(window.parent.origin!==e.origin)return;let{type:t,data:o}=e.data;t===N.v.LOADED&&d(()=>!0),t===N.v.SELECT_NODE&&c(()=>o??[])};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[]);let _=s.length>0;return a.createElement(a.Fragment,null,!i&&a.createElement("div",{className:"post_from_file_modal--embedLoadingSpinnerContainer--x0E-V post_from_file_modal--loadingSpinnerContainer--QaXkG"},a.createElement(k.kt,{size:"large"})),a.createElement("iframe",{ref:t,className:"post_from_file_modal--iframe--W8QSR",title:"Figma",src:l,scrolling:"no"}),a.createElement("div",{className:"post_from_file_modal--footer--UhneR"},a.createElement(b.$$,{onClick:t=>{t.stopPropagation(),e.setNodeInfo({fileKey:e.selectedFile.key,nodeIds:s.map(e=>e.guid),nodeThumbnails:s.reduce((e,{guid:t,thumbnail:o})=>{let a=new Blob([o]),n=URL.createObjectURL(a);return{...e,[t]:n}},{}),backgroundColorByNode:s.reduce((e,{guid:t,backgroundColor:o})=>o?{...e,[t]:o}:e,{})}),e.hideModal?.()},disabled:!_},(0,r.tx)("fig_feed.add_to_post"))))}function R(e){let t=(0,C.ql)(e.orgId),o=h.Qw.useTransformShallowEqual(t,e=>e.filter(e=>e.can_edit)),n="loaded"===o.status,{setSelectedFile:l,onAfterSelect:i}=e,d=a.useCallback(e=>{l(e),i()},[l,i]),[s,c]=a.useState(""),[_,m]=a.useState(null),f=a.useMemo(()=>_?.map(e=>e.model.key)??[],[_]),u=(0,y.IT)(f),p=a.useMemo(()=>null===_?null:"loaded"===u.status?_.filter(e=>u.data[e.model.key]?.canEdit):null,[u,_]),g=a.useCallback(e=>a.createElement("div",{className:"post_from_file_modal--tileContainer--f1mpx",onClick:()=>{d(e)},role:"button",tabIndex:0,key:`tile-${e.key}`},a.createElement("div",{className:"post_from_file_modal--chooseFile--3ABxf"},(0,r.t)("fig_feed.choose_file")),a.createElement(D.GQ,{file:e,currentUser:null,activeFileUsers:[],subtitle:a.createElement(D.lJ,{file:e}),onClick:I.lQ})),[d]),E=a.useMemo(()=>s?p?0===p.length?a.createElement("div",{className:"post_from_file_modal--notFoundContainer--JLJWT text--fontPos16--oMC-G text--_fontBase--QdLsd"},a.createElement("div",null,(0,r.tx)("community.universal_posting_modal.recent_editable_files_search.no_files_matching",{searchQuery:a.createElement(a.Fragment,null,a.createElement("span",{className:"post_from_file_modal--searchQuery--GpUQJ"},s))}))):a.createElement(v.P,{hideScrollbar:!0},a.createElement("div",{className:P},p.map(e=>g(e.model)))):a.createElement("div",{className:A},a.createElement(k.kt,{size:"large"})):o.data&&a.createElement(v.P,{hideScrollbar:!0},a.createElement("div",{className:P},o.data.map(e=>g(e)))),[o.data,p,s,g]);return n?a.createElement(a.Fragment,null,a.createElement("div",{className:"post_from_file_modal--searchContainer--oiMYX"},a.createElement(x.IW,{query:s,setQuery:c,setSearchResults:m,placeholderText:(0,r.t)("fig_feed.search_files")})),E):a.createElement("div",{className:A},a.createElement(k.kt,{size:"large"}))}function z(e){let{setModalPage:t,orgId:o,setSelectedFile:n}=e;return a.createElement(R,{orgId:o,setSelectedFile:n,onAfterSelect:e.skipFrameSelection?e.hideModal:()=>{t?.(2)}})}let W=(0,S.Ju)(function(e){let t=(0,l.wA)(),o=()=>{t(s.Lo()),e.parentRef?.current?.focus()},[n,i]=a.useState(e.attachedFile),[d,c]=a.useState(e.lockFileSelection||e.attachedFile?2:1),{setFeedPostNodeInfo:_}=e,m=a.useCallback(e=>{i(e),_({fileKey:e.key,nodeIds:[]})},[_]),f=e=>c(()=>e);return a.createElement(M.XV,{title:(()=>{switch(d){case 1:return(0,r.t)("fig_feed.choose_a_file");case 2:return a.createElement("div",{className:E()("post_from_file_modal--leftButtonGroup--ZT4p5",e.lockFileSelection&&"post_from_file_modal--headerPadding--6G68d")},!e.lockFileSelection&&a.createElement(T.K0,{svg:B.A,onClick:()=>f(1),"data-tooltip":(0,r.t)("fig_feed.button.back"),"data-tooltip-type":F.Ib.TEXT})," ",n?.name??"");default:(0,p.xb)(d)}})(),onClose:o,containerClassName:"post_from_file_modal--modalView--qMQ2p",innerContainerClassName:"post_from_file_modal--innerModalView--CfMj1",disableClickOutsideToHide:!0,maxWidth:1===d?1024:680,closeOnEsc:!0},(()=>{switch(d){case 1:return a.createElement(z,{orgId:e.orgId,setModalPage:f,setSelectedFile:m,hideModal:o,skipFrameSelection:e.skipFrameSelection});case 2:if(!n)return null;return a.createElement(O,{selectedFile:n,hideModal:o,setNodeInfo:e.setFeedPostNodeInfo});default:(0,p.xb)(d)}})())},"PostFromFileModal");function V(e,t,o,a,l){if(!a||!e)return;let i=e.nodeIds.filter(e=>!t.has(e));0!==i.length&&(queueMicrotask(()=>{(0,n.flushSync)(()=>{o(t=>[...t,...(0,f.Px)(e.fileKey,i,a)])})}),(0,f.Rl)(e.fileKey,i,a,l,e.nodeThumbnails,e.backgroundColorByNode).then(e=>{o(t=>t.map(t=>t.displayContentItem.type===m.cM.NODE&&t.displayContentItem.isLoading?e[t.displayContentItem.nodeId]:t))}))}function Z(e){let{setLinkedFileNodeInfo:t,numUserContentItems:o,hasNodeContent:n,parentModalRef:i,attachedFileKey:c,lockedFileKey:f,currentOrgId:u}=e,p=(0,l.wA)(),g=_.M4.useFile(c).data,E=a.useCallback(e=>{if(!f||e.fileKey===f){if(e.nodeIds.length+o>m.e3){p(d.F.enqueue({message:(0,r.t)("fig_feed.too_many_content_items",{maxNum:m.e3})}));return}t(t=>{let o=e.nodeIds,a=e.nodeThumbnails,n=e.backgroundColorByNode;return t&&e.fileKey===t.fileKey?{fileKey:t.fileKey,nodeIds:[...new Set(t.nodeIds.concat(o))],nodeThumbnails:{...t.nodeThumbnails,...a},backgroundColorByNode:{...t.backgroundColorByNode,...n}}:{fileKey:e.fileKey,nodeIds:o,nodeThumbnails:a,backgroundColorByNode:n}})}},[p,o,f,t]);return{openPostFromFileModal:a.useCallback(e=>{u&&p((0,s.to)({type:W,data:{orgId:u,setFeedPostNodeInfo:E,attachedFile:g,parentRef:i,lockFileSelection:f||g&&n,skipFrameSelection:e?.skipFrameSelection}}))},[p,u,E,g,f,n,i]),attachedFileData:g}}function U(e,t){return{setContentPreview:a.useCallback((o,a,n)=>{let l=Array.from(e),r=l.findIndex(e=>(0,u.K1)(e.displayContentItem)===o),d=l[r];if(d&&(0,m.aT)(d.displayContentItem)){d.preview={url:a,state:n};let e=d.displayContentItem;e.preview_image_url=a,e.backgroundColor=(0,i.colorToHex)(n.backgroundColor),t(l)}else console.error("expected to find matched content item")},[e,t]),snapshotStates:a.useMemo(()=>e.reduce((e,t)=>(t.preview?e[(0,u.K1)(t.displayContentItem)]=t.preview.state:(0,f.EU)(t.displayContentItem)&&(e[(0,u.K1)(t.displayContentItem)]={x:t.displayContentItem.initialX,y:t.displayContentItem.initialY,zoom:t.displayContentItem.initialZoom,ratio:1,backgroundColor:(0,c.dy)(t.displayContentItem.backgroundColor)}),e),{}),[e])}}}}]);

//# debugId=11e0def9-00c4-52d6-9895-18f19ac2a7b0

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/0c745290dac2f41c19596c0da6b6d173589ed8ab/3970-5bf59d5682f80b94.min.js.map